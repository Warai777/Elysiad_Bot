<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Elysiad Journal</title>
  <link rel="stylesheet" href="/static/journal_page_flip.css">
  <link href="https://fonts.googleapis.com/css2?family=EB+Garamond&display=swap" rel="stylesheet">
</head>
<body>
  <div class="tab-container">
    <div class="tab" data-section="hints">Hints</div>
    <div class="tab" data-section="lore">Lore</div>
    <div class="tab" data-section="notes">Notes</div>
  </div>

  <div class="journal-wrapper">
    <div class="book-frame"></div>
    <div id="pageSpread" class="page-spread">
      <div class="page left-page" id="leftPage"></div>
      <div class="page right-page" id="rightPage"></div>
    </div>
  </div>

  <div class="button-container">
    <button class="flip-button" id="prevBtn">Previous</button>
    <button class="flip-button" id="nextBtn">Next</button>
  </div>

  <input class="note-input" id="noteInput" placeholder="Write your note and press Enter..."/>

  <script>
    const sections = {
      hints: ["The Archivist awaits.", "Only fools touch the mirror."],
      lore: ["A coin flipped through dimensions.", "They return on lunar eclipses."],
      notes: []
    };

    const tabEls = document.querySelectorAll('.tab');
    const leftPage = document.getElementById('leftPage');
    const rightPage = document.getElementById('rightPage');
    const noteInput = document.getElementById('noteInput');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    let currentSection = 'hints';
    let currentPage = 0;

    function paginate(content, charsPerPage = 200) {
      const lines = [];
      let buffer = '';
      for (let item of content) {
        if ((buffer + item).length > charsPerPage) {
          lines.push(buffer.trim());
          buffer = '';
        }
        buffer += item + '\n';
      }
      if (buffer.trim()) lines.push(buffer.trim());
      return lines;
    }

    function renderPages() {
      const pages = paginate(sections[currentSection]);
      leftPage.textContent = pages[currentPage] || '';
      rightPage.textContent = pages[currentPage + 1] || '';
    }

    tabEls.forEach(tab => {
      tab.addEventListener('click', () => {
        currentSection = tab.dataset.section;
        currentPage = 0;
        renderPages();
        updateTabs();
      });
    });

    function updateTabs() {
  tabEls.forEach(tab => {
    tab.classList.remove('active');
    if (tab.dataset.section === currentSection) {
      tab.classList.add('active');
    }
  });

  const tabContainer = document.querySelector('.tab-container');
  tabContainer.classList.remove('left', 'right');

  if (currentSection === 'hints') {
    tabContainer.classList.add('right');
  } else if (currentSection === 'lore') {
    tabContainer.classList.add('right');
  } else if (currentSection === 'notes') {
    tabContainer.classList.add('left');
  }
}

    noteInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter' && currentSection === 'notes') {
        const value = noteInput.value.trim();
        if (value) {
          const chars = value.split('');
          let buffer = '';
          function animateWrite() {
            if (chars.length > 0) {
              buffer += chars.shift();
              sections.notes.push(buffer);
              renderPages();
              sections.notes.pop();
              requestAnimationFrame(animateWrite);
            } else {
              sections.notes.push(buffer);
              renderPages();
              noteInput.value = '';
            }
          }
          animateWrite();
        }
      }
    });

    prevBtn.onclick = () => {
      if (currentPage - 2 >= 0) {
        currentPage -= 2;
        renderPages();
      }
    };

    nextBtn.onclick = () => {
      const maxPages = paginate(sections[currentSection]).length;
      if (currentPage + 2 < maxPages) {
        currentPage += 2;
        renderPages();
      }
    };

    // Initial setup
    renderPages();
    updateTabs();
  </script>
</body>
</html>

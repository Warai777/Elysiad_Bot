{% extends "layout.html" %}
{% block content %}
<div class="main-grid">

    <!-- GLOBAL EVENT + TIMER (LEFT) -->
    <div class="side-left">
        <h3>Global Event</h3>
        <div style="margin-bottom:1.2em;font-size:1.04em;">
            {{ global_event }}
        </div>
        <div style="font-size:1.2em;">
            <b>Next Event In:</b>
            <span id="timer">{{ timer // 60 }}:{{ "%02d"|format(timer % 60) }}</span>
        </div>
        <script>
        // Simple countdown updater
        let t={{ timer|int }};
        function updateTimer() {
            if(t>=0){
                let m=Math.floor(t/60), s=(t%60).toString().padStart(2,"0");
                document.getElementById('timer').textContent = `${m}:${s}`;
                t--; if(t>=0) setTimeout(updateTimer,1000);
            }
        }
        updateTimer();
        </script>
    </div>

    <!-- STORY (CENTER, BORDERLESS) -->
    <div class="story-box">
        <h2 style="margin:0 0 0.6em 0;font-weight:700;">Story</h2>
        <div class="story-content">{{ message|safe }}</div>
        {% if user["Story"].get("started", False) %}
        <form method="post" class="choices-form">
            <input type="number" name="choice" min="1" max="5" placeholder="Enter choice 1-5" required>
            <button type="submit">Choose</button>
        </form>
        {% elif not user["Story"].get("started", False) %}
        <form method="post" action="{{ url_for('dashboard') }}" class="choices-form">
            <button type="submit" style="margin:auto;display:block;">Begin Adventure</button>
        </form>
        {% endif %}
    </div>

    <!-- CHARACTER STAT SHEET (RIGHT, MIDDLE) -->
    <div class="side-right">
        <h3>Character Data Sheet</h3>
        <div class="stat-sheet">
            <strong>Tier:</strong> {{ user['Tier'] }}<br>
            <strong>Attack Potency:</strong> {{ user['Attack Potency'] }}<br>
            <strong>Speed:</strong> {{ user['Speed'] }}<br>
            <strong>Durability:</strong> {{ user['Durability'] }}<br>
            <strong>Stamina:</strong> {{ user['Stamina'] }}<br>
            <strong>Range:</strong> {{ user['Range'] }}<br>
            <strong>Intelligence:</strong> {{ user['Intelligence'] }}<br>
            <strong>HP:</strong> {{ user['HP'] }}<br>
            <strong>Origin Essence:</strong> {{ user['Origin Essence'] }}<br>
            <strong>Inventory:</strong>
            <ul>
                {% for item in user['Inventory'] %}
                <li>{{ item }}</li>
                {% else %}
                <li>None</li>
                {% endfor %}
            </ul>
        </div>
    </div>

    <!-- LORE INDEX (BOTTOM RIGHT) -->
    <div class="bottom-right lore-box">
        <h3>Lore Index</h3>
        <ul>
            {% for entry in user['Lore'] %}
            <li>{{ entry }}</li>
            {% else %}
            <li>No lore discovered yet.</li>
            {% endfor %}
        </ul>
        <div style="margin-top:1em;">
            <a href="{{ url_for('lore_index') }}" style="color:#ad8cff;">View All Lore</a>
        </div>
    </div>
</div>
{% endblock %}

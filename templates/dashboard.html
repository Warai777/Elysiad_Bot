{% extends "layout.html" %}
{% block content %}
<div class="dashboard-grid">

    <!-- BEGIN ADVENTURE BUTTON: Only show if not started -->
    {% if not user["Story"].get("started", False) %}
        <form method="post" action="{{ url_for('start_adventure') }}" class="start-form" style="text-align:center; margin-bottom:2em;">
            <button type="submit" class="btn btn-lg btn-primary">Begin Adventure</button>
        </form>
    {% endif %}

    <!-- STORY/CHOICES: Only show if adventure started -->
    <div class="story-box" {% if not user["Story"].get("started", False) %}style="display:none"{% endif %}>
        <h2>Story</h2>
        <!-- STORY HISTORY SCROLL BOX -->
        <div class="story-history" style="max-height:180px; overflow-y:auto; background:#210046; padding:10px; border-radius:8px; margin-bottom:10px;">
            <strong>Previous Choices & Story:</strong>
            <ul style="padding-left:18px;">
            {% for entry in history|reverse %}
                <li style="margin-bottom:8px;">{{ entry|safe }}</li>
            {% else %}
                <li>No previous actions yet.</li>
            {% endfor %}
            </ul>
        </div>
        <!-- END STORY HISTORY SCROLL BOX -->

        <div class="story-content">{{ message|safe }}</div>
        <form method="post" class="choices-form">
            <input type="number" name="choice" min="1" max="5" placeholder="Enter choice 1-5" required>
            <button type="submit">Choose</button>
        </form>
    </div>

    <div class="side-panel">
        <h3>Your Stat Sheet</h3>
        <div class="stat-sheet">
            <strong>Tier:</strong> {{ user['Tier'] }}<br>
            <strong>Attack Potency:</strong> {{ user['Attack Potency'] }}<br>
            <strong>Speed:</strong> {{ user['Speed'] }}<br>
            <strong>Durability:</strong> {{ user['Durability'] }}<br>
            <strong>Stamina:</strong> {{ user['Stamina'] }}<br>
            <strong>Range:</strong> {{ user['Range'] }}<br>
            <strong>Intelligence:</strong> {{ user['Intelligence'] }}<br>
            <strong>HP:</strong> {{ user['HP'] }}<br>
            <strong>Origin Essence:</strong> {{ user['Origin Essence'] }}<br>
            <strong>Inventory:</strong>
            <ul>
                {% for item in user['Inventory'] %}
                <li>{{ item }}</li>
                {% else %}
                <li>None</li>
                {% endfor %}
            </ul>
        </div>
        <h4>Quick Access</h4>
        <ul>
            <li><a href="{{ url_for('char_sheet', username=current_user.username) }}">Your Full Stat Sheet</a></li>
        </ul>
    </div>
</div>
{% endblock %}
